<%- include('header', {admin: true}); -%>


<div class="container">

        <div class="card p-2 m-2">
          <div class="d-flex">
            <div class="flex-shrink-0">
              <img style="height: 5em;" src=<%= stale ? "/images/sad_mac.png" : "/images/happy_mac.png" %> >
            </div>
            <div class="flex-grow-1 ms-3">
              <h3 class="mt-0">Exhibit Status</h3>
              <p>
                Last heard from: <%= lastHeartbeat %><br>
                Current sketch: <%= activeSketch || "unknown" %>
              </p>
            </div>
            </div>
        </div>


        <div class="card p-2 m-2">
          <h3>Sketches</h3>
          <table class="table">
              <thead>
                <tr>
                  <th scope="col">Id</th>
                  <th scope="col">Title</th>
                  <th scope="col">User</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>
                  <% sketches.filter((sketch) => sketch.status === 'APPROVED').forEach(function(sketch) { %>
                      <% if( sketch.id == activeRow) { %>
                        <tr class="table-success">
                      <% } else if(sketch.id == pendingRow) { %>
                        <tr class="table-warning">
                      <% } else { %>
                        <tr>
                      <% } %>
                          <th scope="row"><%= sketch.id %></th>
                          <td><%= sketch.title %></td>
                          <td><%= sketch.userEmail %></td>
                          <td>
                            <form action="/sketch/select" method="post">
                              <% if( sketch.id == activeSketch) { %>
                                <button class="btn btn-primary" disabled>Running</button>
                              <% } else if(sketch.id == pendingRow) { %>
                                <button class="btn btn-primary" disabled>Pending</button>
                              <% } else { %>
                                <button name="sketchId" value="<%= sketch.id %>" class="btn btn-primary">Run</button>
                              <% } %>
                          </form>
                          </td>
                      </tr>
                  <% }); %>
              </tbody>
            </table>
        </div>

        <div class="card p-2 m-2">
          <h3>Unapproved Sketches</h3>
          <table class="table">
              <thead>
                <tr>
                  <th scope="col">Id</th>
                  <th scope="col">Title</th>
                  <th scope="col">User</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>
                  <% sketches.filter((sketch) => sketch.status === 'PENDING').forEach(function(sketch) { %>
                        <tr>
                          <th scope="row"><%= sketch.id %></th>
                          <td><a href="/sketch?sketchID=<%= sketch.id %>" ><%= sketch.title %></a></td>
                          <td><%= sketch.userEmail %></td>
                          <td>
                            <form action="/sketch/evaluate" method="post">
                                <input name="sketchID" type="hidden" value="<%= sketch.id %>"></input>
                                <button name="status" value="APPROVED" class="btn btn-success">Approve</button>
                                <button name="status" value="REJECTED" class="btn btn-danger">Reject</button>
                            </form>
                          </td>
                      </tr>
                  <% }); %>
              </tbody>
            </table>
        </div>

  </div>
</div>

<%- include('footer'); -%>